name: Release

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€ v* æ ‡ç­¾æ—¶è§¦å‘ï¼ˆå¦‚ v1.0.0, v2.1.3ï¼‰

permissions:
  contents: write  # éœ€è¦å†™æƒé™æ¥åˆ›å»º release

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.x'

      - name: Install dependencies
        run: npm install --legacy-peer-deps

      - name: Build extensions
        run: npm run build

      - name: Package extensions
        run: npm run pack

      - name: Get version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create Release with Assets
        uses: softprops/action-gh-release@v2
        with:
          name: Release ${{ steps.get_version.outputs.VERSION }}
          body: |
            ## ğŸš€ Release ${{ steps.get_version.outputs.VERSION }}
            
            ### ğŸ“¦ åŒ…å«çš„æ‰©å±•
            - localization-editor
            - shader-graph
            
            ### ğŸ“¥ ä¸‹è½½è¯´æ˜
            ä¸‹è½½å¯¹åº”çš„ `.zip` æ–‡ä»¶ï¼Œè§£å‹åå°†æ–‡ä»¶å¤¹æ”¾å…¥ Cocos Creator çš„ `extensions` ç›®å½•ä¸­ã€‚
            
            ### ğŸ”§ å®‰è£…æ–¹æ³•
            1. ä¸‹è½½éœ€è¦çš„æ‰©å±• zip æ–‡ä»¶
            2. åœ¨ Cocos Creator ä¸­æ‰“å¼€ `æ‰©å±• > æ‰©å±•ç®¡ç†å™¨`
            3. ç‚¹å‡»å³ä¸Šè§’çš„ `+` æŒ‰é’®
            4. é€‰æ‹© `å¯¼å…¥æ‰©å±•` å¹¶é€‰æ‹©ä¸‹è½½çš„ zip æ–‡ä»¶
            
            ### ğŸ“‹ æ›´æ–°æ—¥å¿—
            è¯·æŸ¥çœ‹ [CHANGELOG.md](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.md) äº†è§£è¯¦ç»†æ›´æ–°å†…å®¹ã€‚
            
            ---
            *æ­¤ç‰ˆæœ¬é€šè¿‡ GitHub Actions è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ*
          files: |
            dist/*.zip
          draft: false
          prerelease: false
          generate_release_notes: true
